#!/usr/bin/env python
import sys
import re
from FWCore.ParameterSet.Types import PSet

try:
    cfiFile = sys.argv[1]
except IndexError:
    print 'Usage: jetIDCutConfig.py PUJETID_PARAMS_FILE'
    sys.exit(1)

execfile(cfiFile)

with open('jetIDCuts.cfg', 'w') as outputFile:
    outputFile.write('# generated by MitPhysics/bin/jetIDCutConfig.py\n# from ' + cfiFile + '\n\n')

    for name in dir():
        obj = eval(name)
        if type(obj) != PSet:
            continue

        blocks = {}
        for paramName in obj.parameterNames_():
            matches = re.match('Pt([0-9]+)_(.+)', paramName)
            if not matches:
                continue

            blockName = matches.group(2)
            if blockName not in blocks:
                blocks[blockName] = [0.] * 4

            param = getattr(obj, paramName)

            ptBin = matches.group(1)
            if ptBin == '010':
                blocks[blockName][0] = ' '.join(map(str, param.value()))
            elif ptBin == '1020':
                blocks[blockName][1] = ' '.join(map(str, param.value()))
            elif ptBin == '2030':
                blocks[blockName][2] = ' '.join(map(str, param.value()))
            elif ptBin == '3050':
                blocks[blockName][3] = ' '.join(map(str, param.value()))

        for blockName, lines in blocks.items():
            outputFile.write(name + ' ' + blockName + '\n')
            for line in lines:
                outputFile.write(line + '\n')

            outputFile.write('\n')


